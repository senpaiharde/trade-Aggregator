<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Trade Aggregator ‚Äî Bought / Sold / Net</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <div class="wrap">
      <header>
        <h1>Trade Aggregator</h1>
        <span class="badge">CSV ‚Üí Bought / Sold / Net</span>
        <span class="hint"
          >Auto-loads & combines all CSVs in /data ‚Ä¢ P/L in ‚Ç™ ‚Ä¢ Weighted prices</span
        >
      </header>

      <section class="panel" id="panel-global">
        <div class="toolbar">
          <label class="btn">
            <input id="fileAll" type="file" accept=".csv,text/csv" />
            üì• Load local CSV (in-memory)
          </label>
          <label class="btn" title="Upload & persist to /data">
            <input id="fileUpload" type="file" accept=".csv,text/csv" />
            ‚¨ÜÔ∏è Upload & Save to /data
          </label>
          <select id="fileSelect" title="Files in /data"></select>
          <button class="btn" id="btnLoadSelected">Load Selected</button>
          <button class="btn" id="btnRefresh">Refresh /data list</button>

          <span class="spacer"></span>

          <button class="btn" id="exportBought">Export Bought CSV</button>
          <button class="btn" id="exportSold">Export Sold CSV</button>
          <button class="btn" id="exportNet">Export Net CSV</button>
        </div>

        <div class="filters">
          <div class="group">
            <span class="muted">App ID</span>
            <input id="fltApp" placeholder="e.g. 730" />
          </div>
          <div class="group">
            <span class="muted">Name contains</span>
            <input id="fltName" placeholder="search text" />
          </div>
          <div class="group">
            <span class="muted">Price (¬¢) min</span>
            <input id="fltMin" type="number" placeholder="min" />
            <span class="muted">max</span>
            <input id="fltMax" type="number" placeholder="max" />
          </div>
          <div class="group">
            <span class="muted">Date from</span>
            <input id="fltFrom" type="datetime-local" />
            <span class="muted">to</span>
            <input id="fltTo" type="datetime-local" />
          </div>
          <button class="btn" id="btnApply">Apply Filters</button>
          <button class="btn" id="btnClear">Clear</button>
        </div>
      </section>

      <div style="height: 18px"></div>

      <section class="panel" id="panel-bought">
        <div class="section-title">Bought</div>
        <div class="table-wrap">
          <table id="tblBought">
            <thead>
              <tr>
                <th data-k="app_id">App ID</th>
                <th data-k="item_name">Item Name</th>
                <th class="num" data-k="price_cents">Price (¬¢)</th>
                <th class="num" data-k="quantity">Qty</th>
                <th class="num" data-k="total_cents">Total (¬¢)</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
        <div class="totals" id="totalsBought"></div>
      </section>

      <div style="height: 18px"></div>

      <section class="panel" id="panel-sold">
        <div class="section-title">Sold</div>
        <div class="table-wrap">
          <table id="tblSold">
            <thead>
              <tr>
                <th data-k="app_id">App ID</th>
                <th data-k="item_name">Item Name</th>
                <th class="num" data-k="price_cents">Price (¬¢)</th>
                <th class="num" data-k="quantity">Qty</th>
                <th class="num" data-k="total_cents">Total (¬¢)</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
        <div class="totals" id="totalsSold"></div>
      </section>

      <div style="height: 18px"></div>

      <section class="panel" id="panel-net">
        <div class="section-title">Net per Item (Sold ‚àí Bought)</div>
        <div class="table-wrap">
          <table id="tblNet">
            <thead>
              <tr>
                <th data-k="app_id">App ID</th>
                <th data-k="item_name">Item Name</th>
                <th class="num" data-k="qty_buy">Buy Qty</th>
                <th class="num" data-k="qty_sell">Sell Qty</th>
                <th class="num" data-k="qty_net">Net Qty</th>
                <th class="num" data-k="avg_buy">Avg Buy (¬¢)</th>
                <th class="num" data-k="avg_sell">Avg Sell (¬¢)</th>
                <th class="num" data-k="pl_pct">P/L %</th>
                <th class="num" data-k="net_value">Net Value (¬¢)</th>
                <th class="num" data-k="net_shekels">Net Value (‚Ç™)</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
        <div class="totals" id="totalsNet"></div>
      </section>

      <div style="height: 18px"></div>

      <section class="panel" id="panel-summary">
        <div class="section-title">Summary</div>
        <div class="totals" id="totalsSummary"></div>
      </section>

      <p class="footnote">
        On startup the app fetches <code>/data-list</code>, loads every <code>.csv</code> in
        <code>/data</code>, merges rows, and then aggregates. P/L % =
        <code>(avgSell / avgBuy - 1) x 100</code>. Prices in CSV are read as **agorot** (¬¢ = 1/100
        ‚Ç™).
      </p>
    </div>

    <script src="script.js"></script>
  </body>
</html>
